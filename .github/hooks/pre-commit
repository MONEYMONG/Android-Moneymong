#!/bin/bash
echo 'ğŸ” Running ktlint check...'

# ë³€ê²½ëœ Kotlin íŒŒì¼ë§Œ ê²€ì‚¬
changed_kotlin_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.kt$|\.kts$')

if [ -z "$changed_kotlin_files" ]; then
    echo 'âœ… No Kotlin files to check'
    exit 0
fi

echo "Checking files: $changed_kotlin_files"

# ktlint ê²€ì‚¬ ì‹¤í–‰
./gradlew ktlintCheck --daemon --build-cache

if [ $? -ne 0 ]; then
    echo 'âŒ ktlint check failed!'
    echo 'ğŸ”§ Trying to auto-format...'

    ./gradlew ktlintFormat --daemon --build-cache  # â† ì—¬ê¸°ê°€ í•µì‹¬!

    if [ $? -eq 0 ]; then
        echo 'âœ… Auto-formatting completed!'
        echo 'ğŸ“ Please review and add the formatted files to your commit:'
        echo "$changed_kotlin_files"
        echo ''
        echo 'Run: git add <files> && git commit'
        exit 1
    else
        echo 'âŒ Auto-formatting failed. Please fix manually.'
        exit 1
    fi
fi

echo 'âœ… ktlint check passed!'
